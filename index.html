<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Score Junken</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDwZQfWkf_h-Dc219uJpTtJNJElZ5l-0Ok",
      authDomain: "score-junken-online.firebaseapp.com",
      projectId: "score-junken-online",
      storageBucket: "score-junken-online.firebasestorage.app",
      messagingSenderId: "656405933288",
      appId: "1:656405933288:web:122a765c95d61b0a0ded5d",
      measurementId: "G-5SDM8HE1N1"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // --- 書き込みテスト ---
    document.getElementById("writeBtn").addEventListener("click", () => {
      db.collection("test").doc("ping").set({ time: Date.now() })
        .then(() => console.log("書き込み成功！"))
        .catch(err => console.error("書き込みエラー:", err));
    });

    // --- 読み込みテスト ---
    document.getElementById("readBtn").addEventListener("click", () => {
      db.collection("test").doc("ping").get()
        .then(doc => {
          if (doc.exists) {
            console.log("読み込み成功:", doc.data());
          } else {
            console.log("ドキュメントが存在しません");
          }
        })
        .catch(err => console.error("読み込みエラー:", err));
    });
  </script>

  <h1>スコアジャンケン</h1>

  <div class="hand-area">
    <!-- 左手選択 -->
    <div class="hand left">
      <h2>左手</h2>
      <div class="hands">

        <div class="hand-item">
          <img src="img/gu.png" alt="グー">
          <button onclick="selectLeft(0)">グー</button>
        </div>

        <div class="hand-item">
          <img src="img/choki.png" alt="チョキ">
          <button onclick="selectLeft(1)">チョキ</button>
        </div>

        <div class="hand-item">
          <img src="img/pa.png" alt="パー">
          <button onclick="selectLeft(2)">パー</button>
        </div>

      </div>
    </div>

    <!-- 右手選択 -->
    <div class="hand right">
      <h2>右手</h2>
      <div class="hands">

        <div class="hand-item">
          <img src="img/light.png" alt="ライト">
          <button onclick="selectRight(1)">ライト</button>
        </div>

        <div class="hand-item">
          <img src="img/drive.png" alt="ドライブ">
          <button onclick="selectRight(2)">ドライブ</button>
        </div>

        <div class="hand-item">
          <img src="img/counter.png" alt="カウンター">
          <button onclick="selectRight(3)">カウンター</button>
        </div>

      </div>
    </div>
  </div>

  <!-- スコア表示 -->
  <div class="score">
    ラウンド: <span id="round">1</span> / 10<br>
    あなた: <span id="pScore">0</span>
    CPU: <span id="cScore">0</span>
  </div>
  

  <!-- ログ -->
  <div class="log" id="log">
    左手と右手を選んでください
  </div>

  <!-- ゲームロジック -->
  <script src="ScoreJunken.js"></script>

  <!-- UI制御 -->
  <script>
    let selectedLeft = null;
    let selectedRight = null;

    function selectLeft(v) {
      selectedLeft = v;
      highlight(".hands:nth-of-type(1) button", v);
      tryPlay();
    }

    function selectRight(v) {
      selectedRight = v;
      highlight(".hands:nth-of-type(2) button", v - 1);
      tryPlay();
    }

    function tryPlay() {
      if (selectedLeft === null || selectedRight === null) return;

      const result = playTurn(selectedLeft, selectedRight);

      // スコア表示
      document.getElementById("pScore").textContent = result.score.player;
      document.getElementById("cScore").textContent = result.score.cpu;

      // ログに追記
      const logEl = document.getElementById("log");
      logEl.textContent += 
        `ラウンド ${round} 結果:\n` +
        `あなた：${handName(result.player.left)} / ${rightName(result.player.right)}  (${format(result.player.gain)})\n` +
        `CPU：${handName(result.cpu.left)} / ${rightName(result.cpu.right)}  (${format(result.cpu.gain)})\n\n`;

      // 自動スクロール（最新ラウンドに移動）
      logEl.scrollTop = logEl.scrollHeight;
      
      round++;

      // ラウンド表示更新
      document.getElementById("round").textContent = round;

      

      // 最大ラウンド到達 → ゲーム終了
      if (round > maxRound) {
        endGame();
        return;
      }

      // 選択状態リセット
      selectedLeft = null;
      selectedRight = null;
      document.querySelectorAll(".hands button").forEach(btn => btn.classList.remove("selected"));
    }

    function handName(v) {
      return ["グー", "チョキ", "パー"][v];
    }

    function rightName(v) {
      return {
        1: "ライト",
        2: "ドライブ",
        3: "カウンター"
      }[v];
    }

    function format(n) {
      if (n > 0) return "+" + n;
      return n.toString();
    }
  </script>

</body>
</html>